@using UCommerce.Api
@functions{
    public static bool? AddToBasket(string addToBasketKey, string quantityKey, UCommerce.EntitiesV2.Product variant)
    {
        var request = HttpContext.Current.Request;

        if (request.Form.AllKeys.All(x => x != addToBasketKey))
        {
            return null;
        }

        if (variant == null)
        {
            return false;
        }

        var quantity = Convert.ToInt32(request.Form[quantityKey]);
        TransactionLibrary.AddToBasket(quantity, variant.Sku, variant.VariantSku);
        TransactionLibrary.ExecuteBasketPipeline();
        var returnUrl = request.RawUrl;
        
        if (returnUrl.Contains("?"))
            HttpContext.Current.Response.Redirect(string.Format("{0}&item-added=true", returnUrl));

        HttpContext.Current.Response.Redirect(string.Format("{0}?item-added=true", returnUrl));
        return true;
    }
}
